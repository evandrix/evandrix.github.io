<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>20150205: SANS Pen Test 2015 Challenge #ShmooCon - writeup</title>
	<link href="../all.min.css" rel="stylesheet" type="text/css" />
	<link href="http://fonts.googleapis.com/css?family=Ubuntu+Mono:400" rel="stylesheet" type="text/css">
	<link href="http://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
	<style type="text/css">
		ul >li:before {content: '-';position: absolute;margin-left: -.7em;}
	</style>
</head>
<body>
	<div id="content">
	  <div id="post">
		<h1><a href="http://www.timeanddate.com/worldclock/fixedtime.html?iso=20150228T0000">20150205</a>: <a href="http://pen-testing.sans.org/challenge2015">SANS Pen Test 2015 Challenge</a> #<a href="www.shmoocon.org">ShmooCon</a> - writeup</h1>
		<div id="postinfo">
		  <div id="postdate"></div>
		  <div id="posttags">tags: netsec, ctf, sans, pentest, shmoocon, 2015</div>
		</div>
		<div id="postbody">
<center>
	<i>Download <a href="SANS-2015-Shmoocon-Challenge.zip">original file</a></i>
	<br>
	<i>Winning <a href="writeup@Colin-Edwards.pdf">entry</a></i>
</center>
<h2><code>/intro_and_questions.txt</code></h2>
<ul>
	<ul>
		<li class="dash">passwd(<code>/open_this_to_win.7z</code>) = concat(<code class="ans">Build It, Belay It, and Bring It On/</code>, <code class="ans">0000c15998</code>, <code class="ans">3e9cd9ea80d80606</code>, <code class="ans">iamnumbersix</code>)</li>
		<li class="dash">which extracts <code>The Phrase That Pays</code></li>
<pre class="frame">
&#8230;
Anyway, here's the last part of the challenge. Send an email with a brief write-up of how you solved each question to <u>shmoochallenge2015@sans.org</u> by <u>February 28, 2015</u>.

Use the following subject for the email: "<i>The narwhal bacons at midnight.</i>"
&#x2026;
</pre>
	</ul>
<hr>
	<li id="qn1" class="print-before none"><u>Q1</u></li>
<pre style="padding:.5em;">
Alice has sent Bob an encrypted file. Find it, decrypt it, and find the secret inside.

Look in the <b>alice.pcap</b> file to answer this question.

Hint: Alice is often quite chatty with Bob, and phrases she references could be
useful to use as passwords (or passphrases). You won't need to use wordlists,
mutation, or brute-force of any kind to decrypt the encrypted file.
</pre>
	<ul>
		<li class="dash">load given <code>alice.pcap</code> into Wireshark</li>
		<li class="dash">apply <em>bpf</em> filter for <b>SMB NT Create AndX Response pkts</b>: <br><code>(smb.cmd == 0xa2) &amp;&amp; (smb.flags.response == 1)</code></li>
		<li class="dash">reveals one of the archives as promised, ie. <code>another_message.7z</code></li>
		<img src="img/another_message.7z.png">
		<li class="dash">follow TCP stream to find the raw dump</li>
		<li class="dash">locate the magic # for 7z: <code>'7' (or \x37), 'z' (or \x7a), 0xBC, 0xAF, 0x27, 0x1C</code></li>
		<li class="dash">carve the required 7zip archive from the SMB pkts captured</li>
		<img src="img/another_message.7z-tcp-stream.png">
		<li class="dash">unfortunately, the archive is password protected :(</li>
		<br>
		<li class="dash">run tool: <a href="http://chaosreader.sourceforge.net"><code>chaosreader</code></a> over <code>alice.pcap</code> to generate a comprehensive HTML report</li>
		<li class="dash">from the webchat log under "<u>GET/POST Report</u>" @ <code>/getpost.html</code> generated</li>
		<li class="dash">clue: <code>PRIVMSG #shmoocon :I_am_Bob: Oh, and <u>my favorite</u>, there's a game going on that <u>blends game hacking, first-person shooting, and role-playing mechanics</u>!</code></li>
		<li class="dash">clue: <code>PRIVMSG #shmoocon :I_am_Bob: You'll have to <u>check the website</u> yourself ;)</code></li>
		<li class="dash">checking the website @ <a href="http://www.shmoocon.org/ghost_in_the_shellcode">http://www.shmoocon.org/ghost_in_the_shellcode</a> as directed</li>
		<li class="dash">exact phrase is indeed found in the webpage description</li>
		<img src="img/ghost_in_the_shellcode.png">
		<li class="dash">so archive password is <code>Ghost in the Shellcode</code></li>
		<br>
		<li class="dash">extract <code>another_message.7z</code> with passwd: <code>Ghost in the Shellcode</code></li>
		<li class="dash">reveals <code>message.txt</code>, containing the secret: <code class="ans">Build It, Belay It, and Bring It On/</code></li>
		<li class="dash">which happens to refer to the three tracks in the <a href="http://www.shmoocon.org">conference</a></li>
	</ul>

	<li id="qn2" class="print-before none"><u>Q2</u></li>
<pre style="padding:.5em;">
Carol has used Firefox for Android to search for, browse, and save a particular image.
A compressed copy of her /data/data/org.mozilla.firefox folder is in the question_assets
folder, named "org.mozilla.firefox.tgz". Find the serial number of the lens used to take
the download picture, which is the secret for this question.

Hint: You may have to use resources outside the org.mozilla.firefox folder to fully
answer this question.
</pre>
	<ul>
		<li class="dash">use tool: <a href="http://www.nirsoft.net/utils/mozilla_cache_viewer.html"><code>MozillaCacheView.exe</code></a> to look for images within the profile cache</li>
		<li class="dash">found <code>1000.jpg</code>, which is also the startup image when loading the profile <code>/org.mozilla.firefox/files/mozilla/9tnld04f.default</code> via <code>firefox -ProfileManager</code></li>
		<li><i>Harrison Ford @ Comic Con</i></li>
		<a href="http://www.businessinsider.com.au/harrison-ford-jj-abrams-can-handle-star-wars-vii-2013-7"><img src="img/1000.jpg"></a>
		<li class="dash">view img EXIF metadata via:
			<ul>
				<li><code>exiftool 1000.jpg | egrep "Lens Serial Number"</code></li>
				<li>online tool: <a href="http://regex.info/exif.cgi"><code>Jeffrey's Exif Viewer</code></a> to find the serial # of the lens used to snap the photo
			</ul>
		</li>
		<img src="img/1000-lens-sno.png">
		<li class="dash">secret obtained: <code class="ans">0000c15998</code></li>
	</ul>

	<li id="qn3" class="print-before none"><u>Q3</u></li>
<pre style="padding:.5em;">
Dave messed up and deleted his only copy of an MP3 file.
He'd really appreciate it if you could retrieve it for him
- look inside svn_2015.dump.gz to get started.

Once you've recovered the audio file, look at it carefully to find the secret.
</pre>
	<ul>
		<li class="dash"><code>gunzip svn_2015.dump.gz</code> &dash;&gt; svn_2015.<a href="http://en.wikipedia.org/wiki/Apache_Subversion">dump</a></li>
		<li class="dash">recreate the SVN repo</li>
			<ul>
				<li>$ <code>svnadmin create repo</code></li>
				<li>$ <code>svnadmin load repo &lt;svn_2015.dump</code></li>
				<li>$ <code>svn co "file://`pwd`/repo" .</code></li>
			</ul>
		<li class="dash">from there, examine the SVN log via <code>svn log</code></li>
<pre style="padding:.5em"><code>------------------------------------------------------------------------
r4 | jeff | 2015-01-09 18:11:38 +0800 (Fri, 09 Jan 2015) | 1 line

Added latest goals
------------------------------------------------------------------------
r3 | jeff | 2015-01-09 18:09:40 +0800 (Fri, 09 Jan 2015) | 1 line

Oh, drat, I wasn't supposed to include that. <font color=red>Deleting the audio file</font>...
------------------------------------------------------------------------
r2 | jeff | 2015-01-09 18:07:32 +0800 (Fri, 09 Jan 2015) | 1 line

Funny audio I heard and VISUALIZED
------------------------------------------------------------------------
r1 | jeff | 2015-01-09 18:05:05 +0800 (Fri, 09 Jan 2015) | 1 line

Added contents of home directory
------------------------------------------------------------------------</code></pre>
		<li class="dash">revert to <i>r2</i> ie. just before the audio file (mp3) was deleted via <code>svn up -r r2</code></li>
		<li class="dash">play the included <code>shmooster.mp3</code></li>
		<li class="dash">intelligble part of the audio can be transcripted, and is similar to:</li>
<u>Futurama: S1Ep5 Fear of a Bot Planet @ 19990420</u>
<pre style="padding:.5em">
Robot Guard #1: Be you robot or human?
Leela: Robot, we be.
Fry: Yep, just two robots out roboting it up.
Robot Guard #2: Administer the test.
Robot Guard #1: Which of the following would you prefer? A. a puppy; B. a flower from your sweetie; or C. a large, properly formatted data file? Choose!
[Fry and Leela discuss in whispers]
Fry: Is the puppy mechanical in any way?
Robot Guard #1: No. It is the bad kind of puppy.
Leela: Then we'll go with that data file.
Robot Guard #1: Correct.
Robot Guard #2: The flower would have also been acceptable.
Robot Guard #1: You may pass.
</pre>
		<li class="dash">extract the section of the audio after this speech</li>
		<li class="dash">view this part as a spectrogram (using any of the various tools eg. sox, sonic visualiser, spek)</li>
		<img src="img/shmooster-mp3-extract-spectrogram.png">
		<li class="dash">notice the embedded QR code ? after performing some image processing cleanup work:</li>
		<img src="img/shmooster-mp3-extract-qr-code.jpg">
		<li class="dash">decode barcode using tool: <a href="http://www.onlinebarcodereader.com"><code>OnlineBarcodeReader.com</code></a></li>
		<img src="img/shmooster-mp3-extract-qr-decoded.png">
		<li class="dash">secret obtained: <code class="ans">3e9cd9ea80d80606</code></li>
	</ul>

	<li id="qn4" class="print-before none"><u>Q4</u></li>
<pre style="padding:.5em;">
Eve suspects that one of Alice, Bob, or Carol might not be as innocent as they seem.
She'll need your help to prove it, however. Examine the other three questions and
their included files. Which user, based off their malicious behavior, might be a Cylon?

Once you know who it is, find that user's password, which is the secret for this question.
</pre>
	<ul>
		<li class="dash">couldn't find any user login credentials in <code>Firefox profile cache ie. /../9tnld04f.default</code> from <a href="#qn2">Q2</a></li>
		<li class="dash">tried <code>alice.pcap</code> from <a href="#qn1">Q1</a> instead</li>
		<li class="dash">noticed that besides <code>another_message.7z</code> sent over <code>SMB</code></li>
		<li class="dash">there was also another file <code>not_exactly_inconspicious.exe</code></li>
		<li class="dash">looking at <code>strings</code> around this binary shows</li>
<pre style="padding:.5em"><code>T 172.16.14.146:4444 -&gt; 172.16.14.138:45959 [AP]
  WCE v1.42beta (<font color=red>Windows Credentials Editor</font>) - (c) 2010-2013 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)..Use -h for help...
  Options:  ...-l..List logon sessions and NTLM credentials (default)....-s..Changes NTLM credentials of current logon session......Parameters
  : &lt;UserName&gt;:&lt;DomainName&gt;:&lt;LMHash&gt;:&lt;NTHash&gt;....-r..Lists logon sessions and NTLM credentials indefinitely......Refreshes every 5 seconds if
  new sessions are found......Optional: -r&lt;refresh interval&gt;....-c..Run &lt;cmd&gt; in a new session with the specified NTLM credentials......Parame
  ters: &lt;cmd&gt;....-e..Lists logon sessions NTLM credentials indefinitely......Refreshes every time a logon event occurs....-o..saves all output
   to a file......Parameters: &lt;filename&gt;....-i..Specify LUID instead of use current logon session......Parameters: &lt;luid&gt;....-d..Delete NTLM c
  redentials from logon session......Parameters: &lt;luid&gt;....-a..Use Addresses......Parameters: &lt;addresses&gt;...-f..Force 'safe mode'....-g..Gener
  ate LM & NT Hash......Parameters: &lt;password&gt;....-K..Dump Kerberos tickets to file (unix & 'windows wce' format)...-k..Read Kerberos tickets
  from file and insert into Windows cache...-w..Dump cleartext passwords stored by the digest authentication package...-v..verbose output...
</code></pre>
		<li class="dash">Alice was using <code>Windows Credentials Editor</code> to edit the user login credentials on Bob's server!</li>
		<li class="dash">searching for Alice's password via <code>ngrep -q -I alice.pcap | egrep -i alice | sort | uniq</code>, this line appears: <br><code>....Alice\IRRELEVANT:<font color=red>iamnumbersix</font>..Bob\IRRELEVANT:Carol_is_my_favorite..NETWORK SERVICE\WORKGROUP:..</code></li>
		<li class="dash">hence, the identity of the Cylon is <b class="ans">Alice</b></li>
		<li class="dash">&amp; the secret (password): <code class="ans">iamnumbersix</code></li>
	</ul>
</ul>
	<center class="print-hidden">--- <strong>FIN</strong> ---</center>
</div></div></div></body></html>
